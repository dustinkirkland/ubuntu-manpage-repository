#!/bin/sh -e

DISTRIB_CODENAME=
if [ ! -z "$1" ] && [ "$1" = "-r" ] && [ ! -z "$2" ]; then
    DISTRIB_CODENAME="$2"
    shift || true
    shift || true
else
    . /etc/lsb-release
fi

# Mirror support of man's languages
if [ ! -z "$LANG" ]; then
	LOCALE="$LANG"
fi
if [ ! -z "$LC_MESSAGES" ]; then
	LOCALE="$LC_MESSAGES"
fi
if echo $LOCALE | grep -q "^en"; then
	LOCALE=""
fi

URL="http://ubuntu.dustinkirkland.com/manpages.gz/"

mandir=`mktemp -d dman.XXXXXX`
trap "rm -rf $mandir" EXIT HUP INT QUIT TERM
for i in `seq 1 9`; do
	man="$mandir/$i"
	if wget -O $man $URL/$DISTRIB_CODENAME/$LOCALE/man$i/$1.$i.gz 2>/dev/null; then
		man -l $man || true
	fi
	rm -f $man
done
